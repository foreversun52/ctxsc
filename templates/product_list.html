<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Mosaddek">
    <meta name="keyword" content="FlatLab, Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
    <link rel="shortcut icon" href="/static/img/favicon.html">

    <title>Basic Table</title>

    <!-- Bootstrap core CSS -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/bootstrap-reset.css" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="/static/css/showBo.css"/>
    <!--external css-->
    <link href="/static/assets/font-awesome/css/font-awesome.css" rel="stylesheet"/>
    <!-- Custom styles for this template -->
    <link href="/static/css/style.css" rel="stylesheet">
    <link href="/static/css/style-responsive.css" rel="stylesheet"/>
            <script src="/static/js/jquery.js"></script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 tooltipss and media queries -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <script src="js/respond.min.js"></script>
    <![endif]-->
</head>

<body>

<section id="container" class="">
    <!--header start-->
    <header class="header white-bg">
        <div class="sidebar-toggle-box">
            <div data-original-title="" data-placement="right" class="icon-reorder tooltips"></div>
        </div>
        <!--logo start-->
        <a href="#" class="logo">晨庭<span>吸塑厂</span></a>
        <!--logo end-->
        <div class="nav notify-row" id="top_menu">
            <!--  notification start -->
            <ul class="nav top-menu">
            </ul>
            <!--  notification end -->
        </div>
        <div class="top-nav">
            <!--search & user info start-->
            <ul class="nav pull-right top-menu">
                <!--                    <li>-->
                <!--                        <input type="text" class="form-control search" placeholder="Search">-->
                <!--                    </li>-->
                <!-- user login dropdown start-->
                <li class="dropdown">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                        <!--                            <img alt="" src="img/avatar1_small.jpg">-->
                        <span class="username">{{ request.user.username }}</span>
                        <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu extended logout">
                        <div class="log-arrow-up"></div>
                        <!--                            <li><a href="#"><i class=" icon-suitcase"></i>Profile</a></li>-->
                        <li><a href="#"><i class="icon-cog"></i>设置</a></li>
                        <!--                            <li><a href="#"><i class="icon-bell-alt"></i> Notification</a></li>-->
                        <li><a href="{% url 'logout' %}"><i class="icon-key"></i>注销</a></li>
                    </ul>
                </li>
                <!-- user login dropdown end -->
            </ul>
            <!--search & user info end-->
        </div>
    </header>
    <!--header end-->
    <!--sidebar start-->
    <aside>
        <div id="sidebar" class="nav-collapse ">
            <!-- sidebar menu start-->
            <ul class="sidebar-menu">
                <li class="">
                    <a class="" href="{% url 'home' %}">
                        <i class="icon-dashboard"></i>
                        <span>主页</span>
                    </a>
                </li>
                <li class="sub-menu">
                    <a href="javascript:;" class="">
                        <i class="icon-user"></i>
                        <span>客户管理</span>
                        <span class="arrow"></span>
                    </a>
                    <ul class="sub">
                        <li><a href="{% url 'member_list' %}">客户列表</a></li>

                    </ul>
                </li>
                <li class="sub-menu active">
                    <a href="javascript:;" class="">
                        <i class="icon-book"></i>
                        <span>产品管理</span>
                        <span class="arrow"></span>
                    </a>
                    <ul class="sub">
                        <li class="active"><a class="" href="{% url 'product_list' %}">产品列表</a></li>
                        <li><a class="" href="{% url 'one_floor_info_list' %}">一楼流程</a></li>
                        <li><a class="" href="{% url 'two_floor_info_list' %}">二楼流程</a></li>
                        <li><a class="" href="{% url 'three_floor_info_list' %}">三楼流程</a></li>
                        <li><a class="" href="{% url 'finished_info_list' %}">产品信息列表</a></li>
                    </ul>
                </li>
                <li class="sub-menu">
                    <a href="javascript:;" class="">
                        <i class="icon-tasks"></i>
                        <span>材料和包装管理</span>
                        <span class="arrow"></span>
                    </a>
                    <ul class="sub">
                        <li><a class="" href="{% url 'material_info' %}">材料信息列表</a></li>
                        <li><a class="" href="{% url 'packing_info' %}">包装信息列表</a></li>
                    </ul>
                </li>
                <li class="sub-menu">
                    <a href="javascript:;" class="">
                        <i class="icon-user"></i>
                        <span>员工管理</span>
                        <span class="arrow"></span>
                    </a>
                    <ul class="sub">
                        <li><a class="" href="{% url 'user_info' %}">成员列表</a></li>
                    </ul>
                </li>
                <li>
                    <a class="" href="#">
                        <i class="icon-cogs"></i>
                        <span>预留接口</span>
                    </a>
                </li>
            </ul>
            <!-- sidebar menu end-->
        </div>
    </aside>
    <!--sidebar end-->
    <!--main content start-->
    <section id="main-content">
        <section class="wrapper">
            <!-- page start-->
            <div class="row">
                <div class="col-lg-12">
                    <section class="panel">
                        <header class="panel-heading">
                            <button href="#myModal" data-toggle="modal" class="btn-success">
                                添加新产品
                            </button>
                        </header>
                        <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="myModal"
                             class="modal fade">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button aria-hidden="true" data-dismiss="modal" class="close" type="button">×
                                        </button>
                                        <h4 class="modal-title">添加新产品</h4>
                                    </div>
                                    <div class="modal-body">
                                        <div role="form">
                                            <div class="form-group">
                                                <label for="exampleInputUsername">产品名</label>
                                                <input type="text" class="form-control" id="product_name" name="product_name" placeholder="请输入产品名">
                                            </div>
                                            <div class="form-group">
                                                <label for="exampleInputPhone">客户名</label>
                                                <select class="form-control m-bot15" id="customer_name_id" name="customer_name_id">
                                                    {% for foo in customer_obj_list %}
                                                        <option value="{{ foo.id }}">{{ foo.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="exampleInputInfo">一楼流程填写人</label>
                                                <select class="form-control m-bot15" name="one_floor" id="one_floor">
                                                    {% for foo in user_obj_list %}
                                                        <option value="{{ foo.id }}">{{ foo.username }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="exampleInputInfo">二楼流程填写人</label>
                                                <select class="form-control m-bot15" name="two_floor" id="two_floor">
                                                    {% for foo in user_obj_list %}
                                                        <option value="{{ foo.id }}">{{ foo.username }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="exampleInputInfo">三楼流程填写人</label>
                                                <select class="form-control m-bot15" name="three_floor" id="three_floor">
                                                    {% for foo in user_obj_list %}
                                                        <option value="{{ foo.id }}">{{ foo.username }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="exampleInputInfo">成品信息列表</label>
                                                <select class="form-control m-bot15" name="finished" id="finished">
                                                    {% for foo in user_obj_list %}
                                                        <option value="{{ foo.id }}">{{ foo.username }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="exampleInputInfo">产品状态</label>
                                                <select id="product_status" name="product_status" class="form-control m-bot15">
                                                    <option value="1">未开始</option>
                                                    <option value="2">制作中</option>
                                                    <option value="3">已完成</option>
                                                </select>
                                            </div>

                                            <div class="form-group">
                                                <label for="exampleInputInfo">产品图片</label>
                                                <label for="myfile">
                                                    <img src="/static/img/default.png" alt="" width="80"
                                                         style="margin-left: 10px" id="product_img">
                                                </label>
                                                <input type="file" id="myfile" name="product_img" style="display: none">
                                            </div>
                                         <div class="form-group">
                                                <label for="exampleInputInfo">创建时间</label>
                                                 <input name="create_date" id="create_date" type="text" placeholder="2020-11-01" size="16" class="form-control">
                                            </div>
                                            <p class="help-block" id="ts"></p>
                                            <button type="submit" onclick="add_product()" class="btn btn-success">添加
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <table class="table table-striped table-advance table-hover">
                            <thead>
                            <tr>
                                <th>产品名</th>
                                <th>客户名</th>
                                <th>产品状态</th>
                                <th>产品图片</th>
                                <th>产品毛利润</th>
                                <th>创建时间</th>
                                <th><i class=" icon-edit"></i>操作</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for product in product_obj_list %}
                                <tr>
                                    <td>{{ product.product_name }}</td>
                                    <td>{{ product.customer_name.name }}</td>
                                    <td>{% if product.product_status == 1 %}未开始{% elif product.product_status == 2 %}
                                        制作中{% elif product.product_status == 3 %}已完成{% endif %}</td>
                                    <td><img src="/media/{{ product.product_img }}" class="pic"
                                                                  height="80px" alt=""></td>
                                <td>{% if product.finished_product.gross_profit %}
                                {{ product.finished_product.gross_profit }}
                                    {% else %}0
                                {% endif %}  元</td>
                                    <td>{{ product.p_create_date | safe }}</td>
                                    <td>
                                         <button href="#myModall{{ product.id }}" data-toggle="modal"
                                                class="btn btn-success btn-xs"><i class="icon-edit"></i></button>
                                        <button href="#myModaAll{{ product.id }}" data-toggle="modal"
                                                class="btn btn-primary btn-xs"><i class="icon-pencil"></i></button>
                                        <button onclick="delete_member({{ product.id }})" class="btn btn-danger btn-xs">
                                            <i class="icon-trash "></i></button>
                                    </td>

                                </tr>
                                <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1"
                                     id="myModaAll{{ product.id }}" class="modal fade">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <button aria-hidden="true" data-dismiss="modal" class="close"
                                                        type="button">×
                                                </button>
                                                <h4 class="modal-title">编辑产品所有参数数据</h4>
                                            </div>
                                            <div class="modal-body">
                                                <div role="form">
                                            <div class="form-group">
                                                        <label for="exampleInputUsername">产品名</label>
                                                        <input type="text" class="form-control" value="{% if product.product_name %}{{ product.product_name }}{% endif %}"
                                                               id="product_name{{ product.id }}"
                                                               name="product_name{{ product.id }}" readonly placeholder="请输入产品名">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="exampleInputPhone">客户名</label>
                                                    <input type="text" class="form-control" value="{% if product.customer_name_id %}{{ product.customer_name.name }}{% endif %}"
                                                               id="customer_name_id{{ product.id }}"
                                                               name="customer_name_id{{ product.id }}" readonly placeholder="客户名">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="exampleInputInfo">一楼流程填写人</label>
                                                    <input type="text" class="form-control" value="{% if product.one_floor.one_floor_user_id %}{{ product.one_floor.one_floor_user.username }}{% endif %}"
                                                               id="one_floor_user{{ product.id }}"
                                                               name="one_floor_user{{ product.id }}" readonly placeholder="一楼流程填写人">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="exampleInputInfo">材料-宽(单位:毫米)</label>
                                                        <input type="text" class="form-control" value="{% if product.one_floor.material_height %}{{ product.one_floor.material_height }}{% endif %}"
                                                               id="material_height{{ product.id }}"
                                                               name="material_height{{ product.id }}" placeholder="材料-宽">
                                                    </div>
                                                <div class="form-group">
                                                        <label for="exampleInputInfo">材料-厚度(单位:丝)</label>
                                                        <input type="text" class="form-control" value="{% if product.one_floor.material_thickness %}{{ product.one_floor.material_thickness }}{% endif %}"
                                                               id="material_thickness{{ product.id }}"
                                                               name="material_thickness{{ product.id }}" placeholder="材料-厚度">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="exampleInputInfo">材料类别</label>
                                                        <select class="form-control m-bot15"
                                                                name="material_id{{ product.id }}"
                                                                id="material_id{{ product.id }}">
                                                            {% for material in material_list %}
                                                                <option {% if material.id == product_info.one_floor.material_type.id %}selected{% endif %}
                                                                        value="{{ material.id }}">{{ material.material_name }}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                <div class="form-group">
                                                        <label for="exampleInputInfo">开机做片时间(单位:秒)</label>
                                                        <input type="text" class="form-control" value="{% if product.one_floor.power_time %}{{ product.one_floor.power_time }}{% endif %}"
                                                               id="power_time{{ product.id }}"
                                                               name="power_time{{ product.id }}" placeholder="开机做片时间">
                                                    </div>
                                                <div class="form-group">
                                                        <label for="exampleInputInfo">拉片长度(单位:厘米)</label>
                                                        <input type="text" class="form-control" value="{% if product.one_floor.pulling_long %}{{ product.one_floor.pulling_long }}{% endif %}"
                                                               id="pulling_long{{ product.id }}"
                                                               name="pulling_long{{ product.id }}" placeholder="拉片长度">
                                                    </div>
                                                <div class="form-group">
                                                        <label for="exampleInputInfo">每片出货数(单位:个/套)</label><br>
                                                        <input type="text" class="form-control" style="width: 250px;display: inline" value="{% if product.one_floor.shipment_num %}{{ product.one_floor.shipment_num }}{% endif %}"
                                                               id="shipment_num{{ product.id }}"
                                                               name="shipment_num{{ product.id }}" placeholder="每片出货数">
                                                        <select id="slice_company{{ product.id }}" name="slice_company{{ product.id }}" style="width: 250px;display: inline" class="form-control">
                                                            <option {% if product.one_floor.slice_company == 1 %}selected{% endif %} value="1">个</option>
                                                            <option {% if product.one_floor.slice_company == 2 %}selected{% endif %} value="2">套</option>
                                                        </select>
                                                    </div>
                                                 <div class="form-group">
                                                        <label for="exampleInputInfo">每吨出货片数(单位:片)</label>
                                                        <input type="text" class="form-control" value="{% if product.one_floor.ton_num %}{{ product.one_floor.ton_num }}{% endif %}"
                                                               id="ton_num{{ product.id }}" readonly
                                                               name="ton_num{{ product.id }}" placeholder="每吨出货片数">
                                                    </div>
                                                 <div class="form-group">
                                                        <label for="exampleInputInfo">每吨成品数(单位:{% if product.one_floor.slice_company == 1 %}个{% elif product.one_floor.slice_company == 2 %}套{% endif %})</label>
                                                       <input type="text" class="form-control" id="ton_nums{{ product.id }}" disabled value="{% if product.one_floor.ton_nums %}{{ product.one_floor.ton_nums }}{% endif %}" name="ton_nums" autocomplete="off" class="layui-input">
                                                    </div>
                                                   <div class="form-group">
                                                        <label for="exampleInputInfo">每吨拉片时长(单位:小时)</label>
                                                        <input type="text" class="form-control" value="{% if product.one_floor.ton_slice_time %}{{ product.one_floor.ton_slice_time }}{% endif %}"
                                                               id="ton_slice_time{{ product.id }}" readonly
                                                               name="ton_slice_time{{ product.id }}" placeholder="每吨拉片时长">
                                                    </div>
                                                                                                    <div class="form-group">
                                                        <label for="exampleInputInfo">二楼流程填写人</label>
                                                    <input type="text" class="form-control" value="{% if product.two_floor.two_floor_user_id %}{{ product.two_floor.two_floor_user.username }}{% endif %}"
                                                               id="two_floor_user{{ product.id }}"
                                                               name="two_floor_user{{ product.id }}" readonly placeholder="二楼流程填写人">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="exampleInputInfo">冲刀拼数(单位:拼)</label>
                                                        <input type="text" class="form-control" value="{% if product.two_floor.knife_num %}{{ product.two_floor.knife_num }}{% endif %}"
                                                               id="knife_num{{ product.id }}"
                                                               name="knife_num{{ product.id }}" placeholder="冲刀拼数">
                                                    </div>
                                                <div class="form-group">
                                                        <label for="exampleInputInfo">冲刀张数(单位:张)</label>
                                                        <input type="text" class="form-control" value="{% if product.two_floor.bed_num %}{{ product.two_floor.bed_num }}{% endif %}"
                                                               id="bed_num{{ product.id }}"
                                                               name="bed_num{{ product.id }}" placeholder="冲刀张数">
                                                    </div>
                                                <div class="form-group">
                                                        <label for="exampleInputInfo">冲床数量(单位:张)</label><br>
                                                        <input type="text" class="form-control" style="width: 250px;display: inline" value="{% if product.two_floor.bed_yield %}{{ product.two_floor.bed_yield }}{% endif %}"
                                                               id="bed_yield{{ product.id }}"
                                                               name="bed_yield{{ product.id }}" placeholder="冲床数量">
                                                        <select id="bed_yield_comany{{ product.id }}" name="bed_yield_comany{{ product.id }}" class="form-control" style="width: 250px;display: inline">
                                                        <option {% if product.two_floor.bed_yield_comany == 1 %}selected{% endif %} value="1">万个</option>
                                                        <option {% if product.two_floor.bed_yield_comany == 2 %}selected{% endif %} value="2">万套</option>
                                                        </select>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="exampleInputInfo">冲床工价(单位:元/刀)</label>
                                                        <input type="text" id="bed_price{{ product.id }}" value="{% if product.two_floor.bed_price %}{{ product.two_floor.bed_price }}{% endif %}"
                                                           name="bed_price{{ product.id }}" autocomplete="off"  class="form-control">
                                                    </div>
                                                <div class="form-group">
                                                        <label for="exampleInputInfo">包装类型</label>
                                                        <select name="two_packing_type{{ product.id }}" class="form-control" id="two_packing_type{{ product.id }}">
                                                            {% for packing in packing_list %}
                                                                <option {% if packing.id == product.two_floor.two_packing_type_id %}selected{% endif %}
                                                                        value="{{ packing.id }}">{{ packing.packing_name }}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                <div class="form-group">
                                                        <label for="exampleInputInfo">包装数量类型</label>
                                                        <select id="packing_num_choices{{ product.id }}" name="packing_num_choices{{ product.id }}" class="form-control">
                                                            <option {% if product.two_floor.packing_num_choices == 1 %}selected{% endif %} value="1">个数</option>
                                                            <option {% if product.two_floor.packing_num_choices == 2 %}selected{% endif %} value="2">重量</option>
                                                        </select>
                                                    </div>
                                                <div class="form-group" id="nums{{ product.id }}" {% if product.two_floor.packing_num_choices == 2 %}style="display: none"{% endif %}>
                                                        <label for="exampleInputInfo">包装数量(个数)(单位:个)</label><br>
                                                        <input type="text" id="two_packing_num_one{{ product.id }}" class="form-control" style="display: inline;width: 70px" value="{% if product.two_floor.two_packing_num_one %}{{ product.two_floor.two_packing_num_one }}{% endif %}" name="two_packing_num_one" autocomplete="off">个*
                                                        <input type="text" id="two_packing_num_two{{ product.id }}" class="form-control" style="display: inline;width: 70px" value="{% if product.two_floor.two_packing_num_two %}{{ product.two_floor.two_packing_num_two }}{% endif %}" name="two_packing_num_one" autocomplete="off">叠*
                                                        <input type="text" id="two_packing_num_three{{ product.id }}" class="form-control" style="display: inline;width: 70px" value="{% if product.two_floor.two_packing_num_three %}{{ product.two_floor.two_packing_num_three }}{% endif %}" name="two_packing_num_one" autocomplete="off">条*
                                                        <input type="text" id="two_packing_num_four{{ product.id }}" class="form-control" style="display: inline;width: 70px" value="{% if product.two_floor.two_packing_num_four %}{{ product.two_floor.two_packing_num_four }}{% endif %}" name="two_packing_num_one" autocomplete="off">层
                                                        &nbsp;&nbsp;共计：<input type="text" id="two_packing_nums{{ product.id }}" class="form-control" style="display: inline;width: 70px" value="{% if product.two_floor.two_packing_nums %}{{ product.two_floor.two_packing_nums }}{% endif %}" name="two_packing_num_one" autocomplete="off">个
                                                </div>

                                                <div class="form-group" id="weight{{ product.id }}" {% if product.two_floor.packing_num_choices == 1 %}style="display: none"{% endif %}>
                                                        <label for="exampleInputInfo">包装数量(重量)(单位:公斤)</label>
                                                        <input type="text" class="form-control" value="{% if product.two_floor.packing_weight %}{{ product.two_floor.packing_weight }}{% endif %}"
                                                               id="packing_weight{{ product.id }}"
                                                               name="packing_weight{{ product.id }}" placeholder="包装数量">
                                                    </div>
                                                 <div class="form-group">
                                                        <label for="exampleInputInfo">包装工价(单位:元)</label>
                                                        <input type="text" class="form-control" value="{% if product.two_floor.two_packing_price %}{{ product.two_floor.two_packing_price }}{% endif %}"
                                                               id="two_packing_price{{ product.id }}"
                                                               name="two_packing_price{{ product.id }}" placeholder="包装工价">
                                                    </div>
                                                 <script>
                                                        $("#packing_num_choices{{ product.id }}").change(function () {
                                                            var packing_type = $("#packing_num_choices{{ product.id }}").find("option:selected").val();
                                                            if(packing_type == 1){
                                                              $("#weight{{ product.id }}").attr("style","display:none;");//隐藏div
                                                              $("#nums{{ product.id }}").attr("style","display:block;");//显示div
                                                          }else if(packing_type == 2){
                                                            $("#nums{{ product.id }}").attr("style","display:none;");//隐藏div
                                                              $("#weight{{ product.id }}").attr("style","display:block;");//显示div
                                                          }
                                                        })
                                                    </script>
                                                   <div class="form-group">
                                                        <label for="exampleInputInfo">三楼流程填写人</label>
                                                    <input type="text" class="form-control" value="{% if product.three_floor.three_floor_user_id %}{{ product.three_floor.three_floor_user.username }}{% endif %}"
                                                               id="three_floor_user{{ product.id }}"
                                                               name="three_floor_user{{ product.id }}" readonly placeholder="二楼流程填写人">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="exampleInputInfo">拆边工价(单位:元)</label>
                                                        <input type="text" class="form-control" value="{% if product.three_floor.edge_price %}{{ product.three_floor.edge_price }}{% endif %}"
                                                               id="edge_price{{ product.id }}"
                                                               name="edge_price{{ product.id }}" placeholder="拆边工价">
                                                    </div>
                                                 <div class="form-group">
                                                        <label for="exampleInputInfo">包装类型</label>
                                                        <select name="three_packing_type{{ product.id }}" class="form-control" id="three_packing_type{{ product.id }}">
                                                            {% for packing in packing_list %}
                                                                <option {% if packing.id == product.three_floor.three_packing_type_id %}selected{% endif %}
                                                                        value="{{ packing.id }}">{{ packing.packing_name }}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                 <div class="form-group">
                                                        <label for="exampleInputInfo">包装数量(个数)(单位:个)</label><br>
                                                        <input type="text" id="three_packing_num_one{{ product.id }}" class="form-control" style="display: inline;width: 70px" value="{% if product.three_floor.three_packing_num_one %}{{ product.three_floor.three_packing_num_one }}{% endif %}" name="three_packing_num_one" autocomplete="off">个*
                                                        <input type="text" id="three_packing_num_two{{ product.id }}" class="form-control" style="display: inline;width: 70px" value="{% if product.three_floor.three_packing_num_two %}{{ product.three_floor.three_packing_num_two }}{% endif %}" name="three_packing_num_one" autocomplete="off">叠*
                                                        <input type="text" id="three_packing_num_three{{ product.id }}" class="form-control" style="display: inline;width: 70px" value="{% if product.three_floor.three_packing_num_three %}{{ product.three_floor.three_packing_num_three }}{% endif %}" name="three_packing_num_one" autocomplete="off">条*
                                                        <input type="text" id="three_packing_num_four{{ product.id }}" class="form-control" style="display: inline;width: 70px" value="{% if product.three_floor.three_packing_num_four %}{{ product.three_floor.three_packing_num_four }}{% endif %}" name="three_packing_num_one" autocomplete="off">层
                                                        &nbsp;&nbsp;共计：<input type="text" id="three_packing_nums{{ product.id }}" class="form-control" style="display: inline;width: 100px" value="{% if product.three_floor.three_packing_nums %}{{ product.three_floor.three_packing_nums }}{% endif %}" name="three_packing_num_one" autocomplete="off">个
                                                    </div>
                                                 <div class="form-group">
                                                        <label for="exampleInputInfo">包装工价(单位:元)</label>
                                                        <input type="text" class="form-control" value="{% if product.three_floor.three_packing_price %}{{ product.three_floor.three_packing_price }}{% endif %}"
                                                               id="three_packing_price{{ product.id }}"
                                                               name="three_packing_price{{ product.id }}" placeholder="包装工价">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="exampleInputInfo">成品数据填写人</label>
                                                    <input type="text" class="form-control" value="{% if product.finished_product.finished_user_id %}{{ product.finished_product.finished_user.username }}{% endif %}"
                                                               id="finished_user_id{{ product.id }}"
                                                               name="finished_user_id{{ product.id }}" readonly placeholder="成品数据填写人">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="exampleInputInfo">整张材料重量(单位:g)</label>
                                                        <input type="text" class="form-control" value="{% if product.finished_product.sheet_weight %}{{ product.finished_product.sheet_weight }}{% endif %}"
                                                               id="sheet_weight{{ product.id }}"
                                                               name="sheet_weight{{ product.id }}" placeholder="整张材料重量">
                                                    </div>
                                                 <div class="form-group">
                                                        <label for="exampleInputInfo">单片成品重量(单位:g)</label>
                                                        <input type="text" class="form-control" value="{% if product.finished_product.slice_weight %}{{ product.finished_product.slice_weight }}{% endif %}"
                                                               id="slice_weight{{ product.id }}"
                                                               name="slice_weight{{ product.id }}" placeholder="单片成品重量">
                                                    </div>
                                                 <div class="form-group">
                                                        <label for="exampleInputInfo">单个成品重量(单位:g)</label><br>
                                                        <input type="text" id="individual_weight{{ product.id }}" class="form-control" value="{% if product.finished_product.individual_weight %}{{ product.finished_product.individual_weight }}{% endif %}" name="individual_weight{{ product.id }}" >
                                                    </div>
                                                 <div class="form-group">
                                                        <label for="exampleInputInfo">边角料重量(单位:g)</label>
                                                        <input type="text" class="form-control" value="{% if product.finished_product.leftovers_weight %}{{ product.finished_product.leftovers_weight }}{% endif %}"
                                                               id="leftovers_weight{{ product.id }}"
                                                               name="leftovers_weight{{ product.id }}" placeholder="边角料重量">
                                                    </div>
                                                 <div class="form-group">
                                                        <label for="exampleInputInfo">边角料占比(单位:%)</label>
                                                        <input type="text" class="form-control" value="{% if product.finished_product.leftovers_percentage %}{{ product.finished_product.leftovers_percentage }}{% endif %}"
                                                               id="leftovers_percentage{{ product.id }}"
                                                               name="leftovers_percentage{{ product.id }}" placeholder="边角料占比">
                                                    </div>
                                                <div class="form-group">
                                                        <label for="exampleInputInfo">成品单价(单位:元/套|元/公斤|元/个)</label><br>
                                                <input type="text" class="form-control" style="width: 250px;display: inline" value="{% if product.finished_product.product_price %}{{ product.finished_product.product_price }}{% endif %}"
                                                               id="product_price{{ product.id }}"
                                                               name="product_price{{ product.id }}" placeholder="成品单价">
                                                            <select style="width: 250px;display: inline" id="product_price_choices{{ product.id }}" name="product_price_choices{{ product.id }}" class="form-control">
                                                        <option {% if product.finished_product.product_price_choices == 1 %}selected{% endif %} value="1">元/套
                                                        </option>
                                                        <option {% if product.finished_product.product_price_choices == 2 %}selected{% endif %} value="2">元/公斤
                                                        </option>
                                                        <option {% if product.finished_product.product_price_choices == 3 %}selected{% endif %} value="3">元/个
                                                        </option>
                                                    </select>
                                                    </div>
                                                 <div class="form-group">
                                                        <label for="exampleInputInfo">材料价格(单位:元/吨)</label>
                                                        <input type="text" class="form-control" value="{% if product.finished_product.material_price %}{{ product.finished_product.material_price }}{% endif %}"
                                                               id="material_price{{ product.id }}"
                                                               name="material_price{{ product.id }}" placeholder="材料价格">
                                                    </div>
                                                 <div class="form-group">
                                                        <label for="exampleInputInfo">毛利润(单位:元/吨)</label>
                                                        <input type="text" class="form-control" value="{% if product.finished_product.gross_profit %}{{ product.finished_product.gross_profit }}{% endif %}"
                                                               id="gross_profit{{ product.id }}"
                                                               name="gross_profit{{ product.id }}" placeholder="毛利润">
                                                    </div>
                                            <p class="help-block" id="ts{{ product.id }}"></p>
                                            <button type="submit" onclick="edit_all_member({{ product.id }})" class="btn btn-success">编辑
                                            </button>
                                        </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1"
                                     id="myModall{{ product.id }}" class="modal fade">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <button aria-hidden="true" data-dismiss="modal" class="close"
                                                        type="button">×
                                                </button>
                                                <h4 class="modal-title">编辑产品资料</h4>
                                            </div>
                                            <div class="modal-body">
                                                <div role="form">
                                            <div class="form-group">
                                                <label for="exampleInputUsername">产品名</label>
                                                <input type="text" class="form-control" value="{% if product.product_name %}{{ product.product_name }}{% endif %}" id="eproduct_name{{ product.id }}" name="eproduct_name{{ product.id }}" placeholder="请输入产品名">
                                            </div>
                                            <div class="form-group">
                                                <label for="exampleInputPhone">客户名</label>
                                                <select class="form-control m-bot15" id="ecustomer_name_id{{ product.id }}" name="ecustomer_name_id{{ product.id }}">
                                                    {% for foo in customer_obj_list %}
                                                        <option {% if foo.id == product.customer_name_id %}selected{% endif %} value="{{ foo.id }}">{{ foo.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="exampleInputInfo">一楼流程填写人</label>
                                                <select class="form-control m-bot15" name="eone_floor{{ product.id }}" id="eone_floor{{ product.id }}">
                                                    {% for foo in user_obj_list %}
                                                        <option {% if foo.id == product.one_floor.one_floor_user_id %}selected{% endif %} value="{{ foo.id }}">{{ foo.username }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="exampleInputInfo">二楼流程填写人</label>
                                                <select class="form-control m-bot15" name="etwo_floor{{ product.id }}" id="etwo_floor{{ product.id }}">
                                                    {% for foo in user_obj_list %}
                                                        <option {% if foo.id == product.two_floor.two_floor_user_id %}selected{% endif %} value="{{ foo.id }}">{{ foo.username }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="exampleInputInfo">三楼流程填写人</label>
                                                <select class="form-control m-bot15" name="ethree_floor{{ product.id }}" id="ethree_floor{{ product.id }}">
                                                    {% for foo in user_obj_list %}
                                                        <option {% if foo.id == product.three_floor.three_floor_user_id %}selected{% endif %} value="{{ foo.id }}">{{ foo.username }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="exampleInputInfo">成品信息列表</label>
                                                <select class="form-control m-bot15" name="efinished{{ product.id }}" id="efinished{{ product.id }}">
                                                    {% for foo in user_obj_list %}
                                                        <option {% if foo.id == product.finished_product.finished_user_id %}selected{% endif %} value="{{ foo.id }}">{{ foo.username }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="exampleInputInfo">产品状态</label>
                                                <select id="eproduct_status{{ product.id }}" name="eproduct_status{{ product.id }}" class="form-control m-bot15">
                                                               <option {% if product.product_status == 1 %}selected{% endif %} value="1">未开始</option>
                    <option {% if product.product_status == 2 %}selected{% endif %} value="2">制作中</option>
                    <option {% if product.product_status == 3 %}selected{% endif %} value="3">已完成</option>
                                                </select>
                                            </div>

                                            <div class="form-group">
                                                <label for="exampleInputInfo">产品图片</label>
                                                <label for="myfilel">
                                                    <img src="{% if product.product_img %}/media/{{ product.product_img }}{% else %}/static/img/default.png{% endif %}" alt="" width="80"
                                                         style="margin-left: 10px" id="product_imgl">
                                                </label>
                                                <input type="file" id="myfilel" name="product_imgl" style="display: none">
                                            </div>
                                         <div class="form-group">
                                                <label for="exampleInputInfo">创建时间</label>
                                                 <input name="create_date{{ product.id }}" id="ecreate_date{{ product.id }}" value="{% if product.p_create_date %}{{ product.p_create_date | safe }}{% endif %}" type="text" placeholder="2020-11-01" size="16" class="form-control">
                                            </div>
                                            <p class="help-block" id="ets{{ product.id }}"></p>
                                            <button type="submit" onclick="edit_member({{ product.id }})" class="btn btn-success">编辑
                                            </button>
                                        </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                            </tbody>
                        </table>
                    </section>
                </div>
            </div>
            <!-- page end-->
        </section>
    </section>
    <!--main content end-->
</section>
<div id="outerdiv" style="position:fixed;top:0;left:0;background:rgba(0,0,0,0.7);z-index:2;width:100%;height:100%;display:none;">
    <div id="innerdiv" style="position:absolute;">
        <img id="bigimg" style="border:5px solid #fff;" src=""/>
    </div>
</div>
<script type="text/javascript" src="/static/assets/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
    <script type="text/javascript" src="/static/assets/bootstrap-daterangepicker/date.js"></script>
    <script type="text/javascript" src="/static/assets/bootstrap-daterangepicker/daterangepicker.js"></script>
    <script type="text/javascript" src="/static/assets/bootstrap-colorpicker/js/bootstrap-colorpicker.js"></script>
    <script type="text/javascript" src="/static/assets/ckeditor/ckeditor.js"></script>
        <script>
            //调整上传文件的配置
        $('#myfile').change(function () {
            // 文件阅读器
            //1 产生一个文件阅读器对象
            var fileReader = new FileReader();
            //2 获取用户上传的文件
            var fileObj = $(this)[0].files[0];
            //3 让文件阅读器读取该文件
            fileReader.readAsDataURL(fileObj);  // 这一步是异步 提交完之后直接运行下一行
            //4 利用文件阅读器将文件展示出来
            fileReader.onload = function () {
                $('#product_img').attr('src', fileReader.result)
            }
        });
            $('#myfilel').change(function () {
            // 文件阅读器
            //1 产生一个文件阅读器对象
            var fileReader = new FileReader();
            //2 获取用户上传的文件
            var fileObj = $(this)[0].files[0];
            //3 让文件阅读器读取该文件
            fileReader.readAsDataURL(fileObj);  // 这一步是异步 提交完之后直接运行下一行
            //4 利用文件阅读器将文件展示出来
            fileReader.onload = function () {
                $('#product_imgl').attr('src', fileReader.result)
            }
        });
            function add_product() {
                var formData = new FormData();
            var name = $("#customer_name_id").val();


            var product_name = $("#product_name").val();
            if (!product_name){
                $('#ts').text('产品名不能为空');
            return
            }
            var one_floor = $("#one_floor").val();
            var two_floor = $("#two_floor").val();
            var three_floor = $("#three_floor").val();
            var finished = $("#finished").val();
            console.log(one_floor);
            console.log(two_floor);
            var product_status = $("#product_status").val();
            var create_date = $("#create_date").val();
            formData.append("file",$("#myfile")[0].files[0]);
            formData.append("name",name);
            formData.append("product_name",product_name);
            formData.append("one_floor",one_floor);
            formData.append("two_floor",two_floor);
            formData.append("three_floor",three_floor);
            formData.append("finished",finished);
            formData.append("product_status",product_status);
            formData.append("create_date",create_date);
           $.ajax({
               type:"POST",
               url:'{% url "add_product" %}',
               data:formData,
               contentType:false,
                processData:false,
                success:function (data) {
                    if (data.code === 1000){
                      $('#ts').text(data.msg);
                      location.reload()
                  } else {
                      $('#ts').text(data.msg);
                      location.reload()
                  }
                }
          });
             return false;
            }

            function edit_member(id) {
            var formData = new FormData();
            var name = $("#ecustomer_name_id"+id).val();
            var product_name = $("#eproduct_name"+id).val();
            var one_floor = $("#eone_floor"+id).val();
            var two_floor = $("#etwo_floor"+id).val();
            var three_floor = $("#ethree_floor"+id).val();
            var finished = $("#efinished"+id).val();
            var product_status = $("#eproduct_status"+id).val();
            var create_date = $("#ecreate_date"+id).val();
            formData.append("file",$("#myfilel")[0].files[0]);
            formData.append("name",name);
            formData.append("product_name",product_name);
            formData.append("one_floor",one_floor);
            formData.append("two_floor",two_floor);
            formData.append("three_floor",three_floor);
            formData.append("finished",finished);
            formData.append("product_status",product_status);
            formData.append("create_date",create_date);
           $.ajax({
               type:"POST",
               url:'/home/edit_product/'+id+'/',
               data:formData,
               contentType:false,
                processData:false,
                success:function (data) {
                    if (data.code === 1000){
                      $('#ets'+id).text(data.msg);
                      location.reload()
                  } else {
                      $('#ets'+id).text(data.msg);
                      location.reload()
                  }
                }
           })
            return false;
            }


            function edit_all_member(id) {
                var formData = new FormData();
        {#var customer_name = $("#customer_name_id" + id).val();#}
        var product_name = $("#product_name" + id).val();
        {#var one_floor = $("#one_floor" + id).val();#}
        var material_height = $("#material_height" + id).val();
        var material_thickness = $("#material_thickness" + id).val();
        var material_id = $("#material_id" + id).val();
        var power_time = $("#power_time" + id).val();
        var pulling_long = $("#pulling_long" + id).val();
        var slice_company = $("#slice_company" + id).val();
        var shipment_num = $("#shipment_num" + id).val();

        formData.append("product_name", product_name);

        formData.append("material_height", material_height);
        formData.append("material_thickness", material_thickness);
        formData.append("material_id", material_id);
        formData.append("power_time", power_time);
        formData.append("pulling_long", pulling_long);
        formData.append("slice_company", slice_company);
        formData.append("shipment_num", shipment_num);
        var bed_num = $("#bed_num" + id).val();
        var knife_num = $("#knife_num" + id).val();
        var bed_yield = $("#bed_yield" + id).val();
        var bed_yield_comany = $("#bed_yield_comany" + id).val();
        var bed_price = $("#bed_price" + id).val();
        var two_packing_type = $("#two_packing_type" + id).val();
        var packing_num_choices = $("#packing_num_choices" + id).val();
        var two_packing_num_one = $("#two_packing_num_one" + id).val();
        var two_packing_num_two = $("#two_packing_num_two" + id).val();
        var two_packing_num_three = $("#two_packing_num_three" + id).val();
        var two_packing_num_four = $("#two_packing_num_four" + id).val();
        var two_packing_nums = $("#two_packing_nums" + id).val();
        var packing_weight = $("#packing_weight" + id).val();
        var two_packing_price = $("#two_packing_price" + id).val();

        formData.append("bed_num", bed_num);
        {#formData.append("two_floor", two_floor);#}
        formData.append("knife_num", knife_num);
        formData.append("bed_yield", bed_yield);
        formData.append("bed_yield_comany", bed_yield_comany);
        formData.append("bed_price", bed_price);
        formData.append("two_packing_type", two_packing_type);
        formData.append("packing_num_choices", packing_num_choices);
        formData.append("two_packing_num_one", two_packing_num_one);
        formData.append("two_packing_num_two", two_packing_num_two);
        formData.append("two_packing_num_three", two_packing_num_three);
        formData.append("two_packing_num_four", two_packing_num_four);
        formData.append("two_packing_nums", two_packing_nums);
        formData.append("packing_weight", packing_weight);
        formData.append("two_packing_price", two_packing_price);
        var edge_price = $("#edge_price" + id).val();
        var three_packing_type = $("#three_packing_type" + id).val();
        {#var packing_num_choices = $("#packing_num_choices" + id).val();#}
        var three_packing_num_one = $("#three_packing_num_one" + id).val();
        var three_packing_num_two = $("#three_packing_num_two" + id).val();
        var three_packing_num_three = $("#three_packing_num_three" + id).val();
        var three_packing_num_four = $("#three_packing_num_four" + id).val();
        var three_packing_nums = $("#three_packing_nums" + id).val();
        var three_packing_price = $("#three_packing_price" + id).val();

        formData.append("edge_price", edge_price);
        formData.append("three_packing_type", three_packing_type);
        {#formData.append("packing_num_choices", packing_num_choices);#}
        formData.append("three_packing_num_one", three_packing_num_one);
        formData.append("three_packing_num_two", three_packing_num_two);
        formData.append("three_packing_num_three", three_packing_num_three);
        formData.append("three_packing_num_four", three_packing_num_four);
        formData.append("three_packing_nums", three_packing_nums);
        formData.append("three_packing_price", three_packing_price);
        var sheet_weight = $("#sheet_weight" + id).val();
        var slice_weight = $("#slice_weight" + id).val();
        var individual_weight = $("#individual_weight" + id).val();
        var leftovers_weight = $("#leftovers_weight" + id).val();
        var leftovers_percentage = $("#leftovers_percentage" + id).val();
        var product_price = $("#product_price" + id).val();
        var product_price_choices = $("#product_price_choices" + id).val();
        var material_price = $("#material_price" + id).val();

        formData.append("sheet_weight", sheet_weight);
        formData.append("slice_weight", slice_weight);
        formData.append("individual_weight", individual_weight);
        formData.append("leftovers_weight", leftovers_weight);
        formData.append("leftovers_percentage", leftovers_percentage);
        formData.append("product_price", product_price);
        formData.append("product_price_choices", product_price_choices);
        formData.append("material_price", material_price);
        $.ajax({
            type: "POST",
            url: '/home/edit_product_info/' + id + '/',
            data: formData,
            contentType: false,
            processData: false,
            success: function (data) {
                if (data.code === 1000) {
                    $('#ts' + id).text(data.msg);
                    location.reload()
                } else {
                    $('#ts' + id).text(data.msg);
                    location.reload()
                }
            }
        })
            }

            function delete_member(id) {
                Showbo.Msg.confirm('您确定删除这条记录吗？', function (x) {
                    if (x === 'yes') {
                        $.post("/home/del_product/" + id + '/', function (data) {
                                if (data.code === 1000) {
                                    Showbo.Msg.alert(data.msg);
                                    location.reload()
                                } else {
                                    Showbo.Msg.alert(data.msg);
                                    location.reload()
                                }
                            }
                        )
                    }
                });
            }
        </script>

        <script type="text/javascript">

            $(function () {
                $(".pic").click(function () {
                    var _this = $(this);//将当前的pimg元素作为_this传入函数
                    imgShow("#outerdiv", "#innerdiv", "#bigimg", _this);
                });
            });

            function imgShow(outerdiv, innerdiv, bigimg, _this) {
                var src = _this.attr("src");//获取当前点击的pimg元素中的src属性
                $(bigimg).attr("src", src);//设置#bigimg元素的src属性
                /*获取当前点击图片的真实大小，并显示弹出层及大图*/
                $("<img/>").attr("src", src).load(function () {
                    var windowW = $(window).width();//获取当前窗口宽度
                    var windowH = $(window).height();//获取当前窗口高度
                    var realWidth = this.width;//获取图片真实宽度
                    var realHeight = this.height;//获取图片真实高度
                    var imgWidth, imgHeight;
                    var scale = 0.8;//缩放尺寸，当图片真实宽度和高度大于窗口宽度和高度时进行缩放
                    if (realHeight > windowH * scale) {//判断图片高度
                        imgHeight = windowH * scale;//如大于窗口高度，图片高度进行缩放
                        imgWidth = imgHeight / realHeight * realWidth;//等比例缩放宽度
                        if (imgWidth > windowW * scale) {//如宽度扔大于窗口宽度
                            imgWidth = windowW * scale;//再对宽度进行缩放
                        }
                    } else if (realWidth > windowW * scale) {//如图片高度合适，判断图片宽度
                        imgWidth = windowW * scale;//如大于窗口宽度，图片宽度进行缩放
                        imgHeight = imgWidth / realWidth * realHeight;//等比例缩放高度
                    } else {//如果图片真实高度和宽度都符合要求，高宽不变
                        imgWidth = realWidth;
                        imgHeight = realHeight;
                    }
                    $(bigimg).css("width", imgWidth);//以最终的宽度对图片缩放
                    var w = (windowW - imgWidth) / 2;//计算图片与窗口左边距
                    var h = (windowH - imgHeight) / 2;//计算图片与窗口上边距
                    $(innerdiv).css({"top": h, "left": w});//设置#innerdiv的top和left属性
                    $(outerdiv).fadeIn("fast");//淡入显示#outerdiv及.pimg
                });
                $(outerdiv).click(function () {//再次点击淡出消失弹出层
                    $(this).fadeOut("fast");
                });
            }

        </script>
        <!-- js placed at the end of the document so the pages load faster -->

        <script src="/static/js/bootstrap.min.js"></script>
        <script src="/static/js/jquery.scrollTo.min.js"></script>
        <script src="/static/js/jquery.nicescroll.js" type="text/javascript"></script>


        <!--common script for all pages-->
        <script src="/static/js/common-scripts.js"></script>
        <script type="text/javascript" src="/static/js/showBo.js"></script>


</body>
</html>
