<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Mosaddek">
    <meta name="keyword" content="FlatLab, Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
    <link rel="shortcut icon" href="/static/img/favicon.html">

    <title>产品信息列表</title>

    <!-- Bootstrap core CSS -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/bootstrap-reset.css" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="/static/css/showBo.css"/>
    <!--external css-->
    <link href="/static/assets/font-awesome/css/font-awesome.css" rel="stylesheet"/>
    <!-- Custom styles for this template -->
    <link href="/static/css/style.css" rel="stylesheet">
    <link href="/static/css/style-responsive.css" rel="stylesheet"/>
    <script src="/static/js/jquery.js"></script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 tooltipss and media queries -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <script src="js/respond.min.js"></script>
    <![endif]-->
</head>

<body>

<section id="container" class="">
    <!--header start-->
    <header class="header white-bg">
        <div class="sidebar-toggle-box">
            <div data-original-title="" data-placement="right" class="icon-reorder tooltips"></div>
        </div>
        <!--logo start-->
        <a href="#" class="logo">晨庭<span>吸塑厂</span></a>
        <!--logo end-->
        <div class="nav notify-row" id="top_menu">
            <!--  notification start -->
            <ul class="nav top-menu">
            </ul>
            <!--  notification end -->
        </div>
        <div class="top-nav">
            <!--search & user info start-->
            <ul class="nav pull-right top-menu">
                <!--                    <li>-->
                <!--                        <input type="text" class="form-control search" placeholder="Search">-->
                <!--                    </li>-->
                <!-- user login dropdown start-->
                <li class="dropdown">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                        <!--                            <img alt="" src="img/avatar1_small.jpg">-->
                        <span class="username">{{ request.user.username }}</span>
                        <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu extended logout">
                        <div class="log-arrow-up"></div>
                        <!--                            <li><a href="#"><i class=" icon-suitcase"></i>Profile</a></li>-->
                        <li><a href="#"><i class="icon-cog"></i>设置</a></li>
                        <!--                            <li><a href="#"><i class="icon-bell-alt"></i> Notification</a></li>-->
                        <li><a href="{% url 'logout' %}"><i class="icon-key"></i>注销</a></li>
                    </ul>
                </li>
                <!-- user login dropdown end -->
            </ul>
            <!--search & user info end-->
        </div>
    </header>
    <!--header end-->
    <!--sidebar start-->
    <aside>
        <div id="sidebar" class="nav-collapse ">
            <!-- sidebar menu start-->
            {% if user.user_type == 1 %}
                <ul class="sidebar-menu">
                <li class="">
                    <a class="" href="{% url 'home' %}">
                        <i class="icon-dashboard"></i>
                        <span>主页</span>
                    </a>
                </li>
                <li class="sub-menu">
                    <a href="javascript:;" class="">
                        <i class="icon-user"></i>
                        <span>客户管理</span>
                        <span class="arrow"></span>
                    </a>
                    <ul class="sub">
                        <li><a href="{% url 'member_list' %}">客户列表</a></li>

                    </ul>
                </li>
                <li class="sub-menu active">
                    <a href="javascript:;" class="">
                        <i class="icon-book"></i>
                        <span>产品管理</span>
                        <span class="arrow"></span>
                    </a>
                    <ul class="sub">
                        <li class=""><a class="" href="{% url 'product_list' %}">产品列表</a></li>
                        <li><a class="" href="{% url 'one_floor_info_list' %}">一楼流程</a></li>
                        <li><a class="" href="{% url 'two_floor_info_list' %}">二楼流程</a></li>
                        <li><a class="" href="{% url 'three_floor_info_list' %}">三楼流程</a></li>
                        <li class="active"><a class="" href="{% url 'finished_info_list' %}">产品信息列表</a></li>
                    </ul>
                </li>
                <li class="sub-menu">
                    <a href="javascript:;" class="">
                        <i class="icon-tasks"></i>
                        <span>材料和包装管理</span>
                        <span class="arrow"></span>
                    </a>
                    <ul class="sub">
                        <li><a class="" href="{% url 'material_info' %}">材料信息列表</a></li>
                        <li><a class="" href="{% url 'packing_info' %}">包装信息列表</a></li>
                    </ul>
                </li>
                <li class="sub-menu">
                    <a href="javascript:;" class="">
                        <i class="icon-user"></i>
                        <span>员工管理</span>
                        <span class="arrow"></span>
                    </a>
                    <ul class="sub">
                        <li><a class="" href="{% url 'user_info' %}">成员列表</a></li>
                    </ul>
                </li>
                <li>
                    <a class="" href="#">
                        <i class="icon-cogs"></i>
                        <span>预留接口</span>
                    </a>
                </li>
            </ul>
                {% elif user.user_type == 2 %}
                <ul class="sidebar-menu">
                <li class="sub-menu active">
                    <a href="javascript:;" class="">
                        <i class="icon-book"></i>
                        <span>产品管理</span>
                        <span class="arrow"></span>
                    </a>
                    <ul class="sub">
                        <li><a class="" href="{% url 'one_floor_info_list' %}">一楼流程</a></li>
                        <li><a class="" href="{% url 'two_floor_info_list' %}">二楼流程</a></li>
                        <li><a class="" href="{% url 'three_floor_info_list' %}">三楼流程</a></li>
                        <li class="active"><a class="" href="{% url 'finished_info_list' %}">产品信息列表</a></li>
                    </ul>
                </li>
                </ul>
            {% endif %}
            <!-- sidebar menu end-->
        </div>
    </aside>
    <!--sidebar end-->
    <!--main content start-->
    <section id="main-content">
        <section class="wrapper">
            <!-- page start-->
            <div class="row">
                <div class="col-lg-12">
                    <section class="panel">
                        <header class="panel-heading">

                        </header>

                        <table class="table table-striped table-advance table-hover">
                            <thead>
                            <tr>
                               <th>品名</th>
                                <th>填写人</th>
                               <th>整张材料重量</th>
                                <th>单片成品重量</th>
                                <th>单个成品重量</th>
                                <th>边角料重量</th>
                                <th>边角料占比</th>
                                <th>成品单价</th>
                                <th>材料价格</th>
                                <th>毛利润</th>
                                <th><i class=" icon-edit"></i>操作</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for product in product_obj_list %}
                                <tr>
                                  <td>{{ product.product_name }}</td>
                                  <td>{{ product.finished_product.finished_user.username }}</td>
                                    <td>{% if product.finished_product.sheet_weight %}
                                     {{ product.finished_product.sheet_weight }} g
                                    {% endif %}</td>
                                    <td>{% if product.finished_product.slice_weight %}
                                     {{ product.finished_product.slice_weight }} g
                                    {% endif %}</td>
                                    <td>{% if product.finished_product.individual_weight %}
                                     {{ product.finished_product.individual_weight }} g
                                    {% endif %}</td>
                                    <td>{% if product.finished_product.leftovers_weight %}
                                     {{ product.finished_product.leftovers_weight }} g
                                    {% endif %}</td>
                                    <td>{% if product.finished_product.leftovers_percentage %}
                                     {{ product.finished_product.leftovers_percentage }} %
                                    {% endif %}</td>
                                    <td>{% if product.finished_product.product_price %}
                                     {{ product.finished_product.product_price }} 元/{% if product.finished_product.product_price_choices == 1 %}套{% elif product.finished_product.product_price_choices == 2 %}公斤{% elif product.finished_product.product_price_choices == 3 %}个{% endif %}
                                    {% endif %}</td>
                                    <td>{% if product.one_floor.material_type.material_price %}
                                     {{ product.one_floor.material_type.material_price }} 元/吨
                                    {% endif %}</td>
                                    <td>{% if product.finished_product.gross_profit %}
                                     {{ product.finished_product.gross_profit }} 元/吨
                                    {% endif %}</td>
                                    <td>
                                        <button href="#myModall{{ product.id }}" data-toggle="modal"
                                                class="btn btn-primary btn-xs"><i class="icon-pencil"></i></button>
                                    </td>
                                </tr>
                                <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1"
                                     id="myModall{{ product.id }}" class="modal fade">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <button aria-hidden="true" data-dismiss="modal" class="close"
                                                        type="button">×
                                                </button>
                                                <h4 class="modal-title">编辑产品“{{ product.product_name }}”的资料</h4>
                                            </div>
                                            <div class="modal-body">
                                                <div role="form">
{#                                                    <div class="form-group">#}
{#                                                        <label for="exampleInputUsername">产品名</label>#}
{#                                                        <input type="text" class="form-control" value="{% if product.product_name %}{{ product.product_name }}{% endif %}"#}
{#                                                               id="product_name{{ product.id }}"#}
{#                                                               name="product_name{{ product.id }}" readonly placeholder="请输入产品名">#}
{#                                                    </div>#}
                                                    <div class="form-group">
                                                        <label for="exampleInputPhone">客户名</label>
                                                    <input type="text" class="form-control" value="{% if product.customer_name_id %}{{ product.customer_name.name }}{% endif %}"
                                                               id="customer_name_id{{ product.id }}"
                                                               name="customer_name_id{{ product.id }}" readonly placeholder="客户名">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="exampleInputInfo">成品数据填写人</label>
                                                    <input type="text" class="form-control" value="{% if product.finished_product.finished_user_id %}{{ product.finished_product.finished_user.username }}{% endif %}"
                                                               id="finished_user_id{{ product.id }}"
                                                               name="finished_user_id{{ product.id }}" readonly placeholder="成品数据填写人">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="exampleInputInfo">整张材料重量(单位:g)</label>
                                                        <input type="text" class="form-control" value="{% if product.finished_product.sheet_weight %}{{ product.finished_product.sheet_weight }}{% endif %}"
                                                               id="sheet_weight{{ product.id }}"
                                                               name="sheet_weight{{ product.id }}" placeholder="整张材料重量">
                                                    </div>
                                                 <div class="form-group">
                                                        <label for="exampleInputInfo">单片成品重量(单位:g)</label>
                                                        <input type="text" class="form-control" value="{% if product.finished_product.slice_weight %}{{ product.finished_product.slice_weight }}{% endif %}"
                                                               id="slice_weight{{ product.id }}"
                                                               name="slice_weight{{ product.id }}" placeholder="单片成品重量">
                                                    </div>
                                                 <div class="form-group">
                                                        <label for="exampleInputInfo">单个成品重量(单位:g)</label><br>
                                                        <input type="text" id="individual_weight{{ product.id }}" class="form-control" value="{% if product.finished_product.individual_weight %}{{ product.finished_product.individual_weight }}{% endif %}" name="individual_weight{{ product.id }}" >
                                                    </div>
                                                 <div class="form-group">
                                                        <label for="exampleInputInfo">边角料重量(单位:g)</label>
                                                        <input type="text" class="form-control" value="{% if product.finished_product.leftovers_weight %}{{ product.finished_product.leftovers_weight }}{% endif %}"
                                                               id="leftovers_weight{{ product.id }}"
                                                               name="leftovers_weight{{ product.id }}" placeholder="边角料重量">
                                                    </div>
                                                 <div class="form-group">
                                                        <label for="exampleInputInfo">边角料占比(单位:%)</label>
                                                        <input type="text" class="form-control" value="{% if product.finished_product.leftovers_percentage %}{{ product.finished_product.leftovers_percentage }}{% endif %}"
                                                               id="leftovers_percentage{{ product.id }}"
                                                               name="leftovers_percentage{{ product.id }}" readonly placeholder="边角料占比">
                                                    </div>
                                                <div class="form-group">
                                                        <label for="exampleInputInfo">成品单价(单位:元/套|元/公斤|元/个)</label><br>
                                                <input type="text" class="form-control" style="width: 250px;display: inline" value="{% if product.finished_product.product_price %}{{ product.finished_product.product_price }}{% endif %}"
                                                               id="product_price{{ product.id }}"
                                                               name="product_price{{ product.id }}" placeholder="成品单价">
                                                            <select style="width: 250px;display: inline" id="product_price_choices{{ product.id }}" name="product_price_choices{{ product.id }}" class="form-control">
                                                        <option {% if product.finished_product.product_price_choices == 1 %}selected{% endif %} value="1">元/套
                                                        </option>
                                                        <option {% if product.finished_product.product_price_choices == 2 %}selected{% endif %} value="2">元/公斤
                                                        </option>
                                                        <option {% if product.finished_product.product_price_choices == 3 %}selected{% endif %} value="3">元/个
                                                        </option>
                                                    </select>
                                                    </div>
                                                 <div class="form-group">
                                                        <label for="exampleInputInfo">材料价格(单位:元/吨)</label>
                                                        <input type="text" class="form-control" value="{% if product.one_floor.material_type.material_price %}{{ product.one_floor.material_type.material_price }}{% endif %}"
                                                               id="material_price{{ product.id }}"
                                                               name="material_price{{ product.id }}" readonly placeholder="材料价格">
                                                    </div>
                                                 <div class="form-group">
                                                        <label for="exampleInputInfo">毛利润(单位:元/吨)</label>
                                                        <input type="text" class="form-control" value="{% if product.finished_product.gross_profit %}{{ product.finished_product.gross_profit }}{% endif %}"
                                                               id="gross_profit{{ product.id }}"
                                                               name="gross_profit{{ product.id }}" readonly placeholder="毛利润">
                                                    </div>
                                                    <p class="help-block" id="ts{{ product.id }}"></p>
                                                    <button type="submit" onclick="edit_member({{ product.id }})"
                                                            class="btn btn-success">编辑
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                            </tbody>
                        </table>
                    </section>
                </div>
            </div>
            <!-- page end-->
        </section>
    </section>
    <!--main content end-->
</section>
<div id="outerdiv" style="position:fixed;top:0;left:0;background:rgba(0,0,0,0.7);z-index:2;width:100%;height:100%;display:none;">
    <div id="innerdiv" style="position:absolute;">
        <img id="bigimg" style="border:5px solid #fff;" src=""/>
    </div>
</div>
<script type="text/javascript" src="/static/assets/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
<script type="text/javascript" src="/static/assets/bootstrap-daterangepicker/date.js"></script>
<script type="text/javascript" src="/static/assets/bootstrap-daterangepicker/daterangepicker.js"></script>
<script type="text/javascript" src="/static/assets/bootstrap-colorpicker/js/bootstrap-colorpicker.js"></script>
<script type="text/javascript" src="/static/assets/ckeditor/ckeditor.js"></script>
<script>

    function edit_member(id) {
        var formData = new FormData();
        var sheet_weight = $("#sheet_weight" + id).val();
        var slice_weight = $("#slice_weight" + id).val();
        var individual_weight = $("#individual_weight" + id).val();
        var leftovers_weight = $("#leftovers_weight" + id).val();
        var leftovers_percentage = $("#leftovers_percentage" + id).val();
        var product_price = $("#product_price" + id).val();
        var product_price_choices = $("#product_price_choices" + id).val();
        var material_price = $("#material_price" + id).val();

        formData.append("sheet_weight", sheet_weight);
        formData.append("slice_weight", slice_weight);
        formData.append("individual_weight", individual_weight);
        formData.append("leftovers_weight", leftovers_weight);
        formData.append("leftovers_percentage", leftovers_percentage);
        formData.append("product_price", product_price);
        formData.append("product_price_choices", product_price_choices);
        formData.append("material_price", material_price);

        $.ajax({
            type: "POST",
            url: '/home/edit_finished_info/' + id + '/',
            data: formData,
            contentType: false,
            processData: false,
            success: function (data) {
                if (data.code === 1000) {
                    $('#ts' + id).text(data.msg);
                    location.reload()
                } else {
                    $('#ts' + id).text(data.msg);
                    location.reload()
                }
            }
        })
        return false;
    }

    function delete_member(id) {
        Showbo.Msg.confirm('您确定删除这条记录吗？', function (x) {
            if (x === 'yes') {
                $.post("/home/del_product/" + id + '/', function (data) {
                        if (data.code === 1000) {
                            Showbo.Msg.alert(data.msg);
                            location.reload()
                        } else {
                            Showbo.Msg.alert(data.msg);
                            location.reload()
                        }
                    }
                )
            }
        });
    }
</script>

<script type="text/javascript">

    $(function () {
        $(".pic").click(function () {
            var _this = $(this);//将当前的pimg元素作为_this传入函数
            imgShow("#outerdiv", "#innerdiv", "#bigimg", _this);
        });
    });

    function imgShow(outerdiv, innerdiv, bigimg, _this) {
        var src = _this.attr("src");//获取当前点击的pimg元素中的src属性
        $(bigimg).attr("src", src);//设置#bigimg元素的src属性
        /*获取当前点击图片的真实大小，并显示弹出层及大图*/
        $("<img/>").attr("src", src).load(function () {
            var windowW = $(window).width();//获取当前窗口宽度
            var windowH = $(window).height();//获取当前窗口高度
            var realWidth = this.width;//获取图片真实宽度
            var realHeight = this.height;//获取图片真实高度
            var imgWidth, imgHeight;
            var scale = 0.8;//缩放尺寸，当图片真实宽度和高度大于窗口宽度和高度时进行缩放
            if (realHeight > windowH * scale) {//判断图片高度
                imgHeight = windowH * scale;//如大于窗口高度，图片高度进行缩放
                imgWidth = imgHeight / realHeight * realWidth;//等比例缩放宽度
                if (imgWidth > windowW * scale) {//如宽度扔大于窗口宽度
                    imgWidth = windowW * scale;//再对宽度进行缩放
                }
            } else if (realWidth > windowW * scale) {//如图片高度合适，判断图片宽度
                imgWidth = windowW * scale;//如大于窗口宽度，图片宽度进行缩放
                imgHeight = imgWidth / realWidth * realHeight;//等比例缩放高度
            } else {//如果图片真实高度和宽度都符合要求，高宽不变
                imgWidth = realWidth;
                imgHeight = realHeight;
            }
            $(bigimg).css("width", imgWidth);//以最终的宽度对图片缩放
            var w = (windowW - imgWidth) / 2;//计算图片与窗口左边距
            var h = (windowH - imgHeight) / 2;//计算图片与窗口上边距
            $(innerdiv).css({"top": h, "left": w});//设置#innerdiv的top和left属性
            $(outerdiv).fadeIn("fast");//淡入显示#outerdiv及.pimg
        });
        $(outerdiv).click(function () {//再次点击淡出消失弹出层
            $(this).fadeOut("fast");
        });
    }

</script>
<!-- js placed at the end of the document so the pages load faster -->

<script src="/static/js/bootstrap.min.js"></script>
<script src="/static/js/jquery.scrollTo.min.js"></script>
<script src="/static/js/jquery.nicescroll.js" type="text/javascript"></script>


<!--common script for all pages-->
<script src="/static/js/common-scripts.js"></script>
<script type="text/javascript" src="/static/js/showBo.js"></script>


</body>
</html>
