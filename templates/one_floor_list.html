<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Mosaddek">
    <meta name="keyword" content="FlatLab, Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
    <link rel="shortcut icon" href="/static/img/favicon.html">

    <title>Basic Table</title>

    <!-- Bootstrap core CSS -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/bootstrap-reset.css" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="/static/css/showBo.css"/>
    <!--external css-->
    <link href="/static/assets/font-awesome/css/font-awesome.css" rel="stylesheet"/>
    <!-- Custom styles for this template -->
    <link href="/static/css/style.css" rel="stylesheet">
    <link href="/static/css/style-responsive.css" rel="stylesheet"/>
    <script src="/static/js/jquery.js"></script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 tooltipss and media queries -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <script src="js/respond.min.js"></script>
    <![endif]-->
</head>

<body>

<section id="container" class="">
    <!--header start-->
    <header class="header white-bg">
        <div class="sidebar-toggle-box">
            <div data-original-title="" data-placement="right" class="icon-reorder tooltips"></div>
        </div>
        <!--logo start-->
        <a href="#" class="logo">晨庭<span>吸塑厂</span></a>
        <!--logo end-->
        <div class="nav notify-row" id="top_menu">
            <!--  notification start -->
            <ul class="nav top-menu">
            </ul>
            <!--  notification end -->
        </div>
        <div class="top-nav">
            <!--search & user info start-->
            <ul class="nav pull-right top-menu">
                <!--                    <li>-->
                <!--                        <input type="text" class="form-control search" placeholder="Search">-->
                <!--                    </li>-->
                <!-- user login dropdown start-->
                <li class="dropdown">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                        <!--                            <img alt="" src="img/avatar1_small.jpg">-->
                        <span class="username">{{ request.user.username }}</span>
                        <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu extended logout">
                        <div class="log-arrow-up"></div>
                        <!--                            <li><a href="#"><i class=" icon-suitcase"></i>Profile</a></li>-->
                        <li><a href="#"><i class="icon-cog"></i>设置</a></li>
                        <!--                            <li><a href="#"><i class="icon-bell-alt"></i> Notification</a></li>-->
                        <li><a href="{% url 'logout' %}"><i class="icon-key"></i>注销</a></li>
                    </ul>
                </li>
                <!-- user login dropdown end -->
            </ul>
            <!--search & user info end-->
        </div>
    </header>
    <!--header end-->
    <!--sidebar start-->
    <aside>
        <div id="sidebar" class="nav-collapse ">
            <!-- sidebar menu start-->
            {% if user.user_type == 1 %}
                <ul class="sidebar-menu">
                <li class="">
                    <a class="" href="{% url 'home' %}">
                        <i class="icon-dashboard"></i>
                        <span>主页</span>
                    </a>
                </li>
                <li class="sub-menu">
                    <a href="javascript:;" class="">
                        <i class="icon-user"></i>
                        <span>客户管理</span>
                        <span class="arrow"></span>
                    </a>
                    <ul class="sub">
                        <li><a href="{% url 'member_list' %}">客户列表</a></li>

                    </ul>
                </li>
                <li class="sub-menu active">
                    <a href="javascript:;" class="">
                        <i class="icon-book"></i>
                        <span>产品管理</span>
                        <span class="arrow"></span>
                    </a>
                    <ul class="sub">
                        <li class=""><a class="" href="{% url 'product_list' %}">产品列表</a></li>
                        <li class="active"><a class="" href="{% url 'one_floor_info_list' %}">一楼流程</a></li>
                        <li><a class="" href="{% url 'two_floor_info_list' %}">二楼流程</a></li>
                        <li><a class="" href="{% url 'three_floor_info_list' %}">三楼流程</a></li>
                        <li><a class="" href="{% url 'finished_info_list' %}">产品信息列表</a></li>
                    </ul>
                </li>
                <li class="sub-menu">
                    <a href="javascript:;" class="">
                        <i class="icon-tasks"></i>
                        <span>材料和包装管理</span>
                        <span class="arrow"></span>
                    </a>
                    <ul class="sub">
                        <li><a class="" href="{% url 'material_info' %}">材料信息列表</a></li>
                        <li><a class="" href="{% url 'packing_info' %}">包装信息列表</a></li>
                    </ul>
                </li>
                <li class="sub-menu">
                    <a href="javascript:;" class="">
                        <i class="icon-user"></i>
                        <span>员工管理</span>
                        <span class="arrow"></span>
                    </a>
                    <ul class="sub">
                        <li><a class="" href="{% url 'user_info' %}">成员列表</a></li>
                    </ul>
                </li>
                <li>
                    <a class="" href="#">
                        <i class="icon-cogs"></i>
                        <span>预留接口</span>
                    </a>
                </li>
            </ul>
                {% elif user.user_type == 2 %}
                <ul class="sidebar-menu">
                <li class="sub-menu active">
                    <a href="javascript:;" class="">
                        <i class="icon-book"></i>
                        <span>产品管理</span>
                        <span class="arrow"></span>
                    </a>
                    <ul class="sub">
                        <li class="active"><a class="" href="{% url 'one_floor_info_list' %}">一楼流程</a></li>
                        <li><a class="" href="{% url 'two_floor_info_list' %}">二楼流程</a></li>
                        <li><a class="" href="{% url 'three_floor_info_list' %}">三楼流程</a></li>
                        <li><a class="" href="{% url 'finished_info_list' %}">产品信息列表</a></li>
                    </ul>
                </li>
                </ul>

            {% endif %}
            <!-- sidebar menu end-->
        </div>
    </aside>
    <!--sidebar end-->
    <!--main content start-->
    <section id="main-content">
        <section class="wrapper">
            <!-- page start-->
            <div class="row">
                <div class="col-lg-12">
                    <section class="panel">
                        <header class="panel-heading">
                        </header>

                        <table class="table table-striped table-advance table-hover">
                            <thead>
                            <tr>
                                <th>品名</th>
                                <th>填写人</th>
                                <th>材料规格</th>
                                <th>开机做片时间</th>
                                <th>拉片长度</th>
                                <th>每片出货数(个/套)</th>
                                <th>每吨出货片数</th>
                                <th>每吨成品数量</th>
                                <th>每吨拉片时间</th>
                                <th><i class=" icon-edit"></i>操作</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for product in product_obj_list %}
                                <tr>
                                    <td>{{ product.product_name }}</td>
                                    <td>{{ product.one_floor.one_floor_user.username }}</td>
                                    <td>{% if product.one_floor.material_height %}
                                    {{ product.one_floor.material_height }}{% else %}0{% endif %} *{% if product.one_floor.material_thickness %}{{ product.one_floor.material_thickness }}{% else %}0
                                    {% endif %} {{ product.one_floor.material_type.material_name }}</td>
                                    <td>{% if product.one_floor.power_time %}
                                    {{ product.one_floor.power_time }}
                                        {% else %}0
                                    {% endif %}  秒</td>
                                    <td>{% if  product.one_floor.pulling_long  %}
                                    {{ product.one_floor.pulling_long }}
                                        {% else %}0
                                    {% endif %}  厘米</td>
                                    <td>{{ product.one_floor.shipment_num }} {% if product.one_floor.slice_company == 1 %}
                                        个{% elif product.one_floor.slice_company == 2 %}套{% endif %}</td>
                                    <td>{% if  product.one_floor.ton_num  %}
                                    {{ product.one_floor.ton_num }}
                                        {% else %}0
                                    {% endif %}  片</td>
                                    <td>{% if product.one_floor.ton_nums %}
                                    {{ product.one_floor.ton_nums }}
                                        {% else %}0
                                    {% endif %} {% if product.one_floor.slice_company == 1 %}
                                        个{% elif product.one_floor.slice_company == 2 %}套{% endif %}</td>
                                    <td>{% if product.one_floor.ton_slice_time %}
                                    {{ product.one_floor.ton_slice_time }}
                                        {% else %}0
                                    {% endif %}小时</td>
                                    <td>
                                        <button href="#myModall{{ product.id }}" data-toggle="modal"
                                                class="btn btn-primary btn-xs"><i class="icon-pencil"></i></button>
                                    </td>

                                </tr>
                                <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1"
                                     id="myModall{{ product.id }}" class="modal fade">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <button aria-hidden="true" data-dismiss="modal" class="close"
                                                        type="button">×
                                                </button>
                                                <h4 class="modal-title">编辑产品资料</h4>
                                            </div>
                                            <div class="modal-body">
                                                <div role="form">
                                                    <div class="form-group">
                                                        <label for="exampleInputUsername">产品名</label>
                                                        <input type="text" class="form-control" value="{% if product.product_name %}{{ product.product_name }}{% endif %}"
                                                               id="product_name{{ product.id }}"
                                                               name="product_name{{ product.id }}" readonly placeholder="请输入产品名">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="exampleInputPhone">客户名</label>
                                                    <input type="text" class="form-control" value="{% if product.customer_name_id %}{{ product.customer_name.name }}{% endif %}"
                                                               id="customer_name_id{{ product.id }}"
                                                               name="customer_name_id{{ product.id }}" readonly placeholder="客户名">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="exampleInputInfo">一楼流程填写人</label>
                                                    <input type="text" class="form-control" value="{% if product.one_floor.one_floor_user_id %}{{ product.one_floor.one_floor_user.username }}{% endif %}"
                                                               id="one_floor_user{{ product.id }}"
                                                               name="one_floor_user{{ product.id }}" readonly placeholder="一楼流程填写人">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="exampleInputInfo">材料-宽(单位:毫米)</label>
                                                        <input type="text" class="form-control" value="{% if product.one_floor.material_height %}{{ product.one_floor.material_height }}{% endif %}"
                                                               id="material_height{{ product.id }}" onblur="checkMaterialHeight(this.value, {{ product.id }})"
                                                               name="material_height{{ product.id }}" placeholder="材料-宽">
                                                    </div>
                                                <div class="form-group">
                                                        <label for="exampleInputInfo">材料-厚度(单位:丝)</label>
                                                        <input type="text" class="form-control" value="{% if product.one_floor.material_thickness %}{{ product.one_floor.material_thickness }}{% endif %}"
                                                               id="material_thickness{{ product.id }}" onblur="checkMaterialThickness(this.value, {{ product.id }})"
                                                               name="material_thickness{{ product.id }}" placeholder="材料-厚度">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="exampleInputInfo">材料类别</label>
                                                        <select class="form-control m-bot15"
                                                                name="material_id{{ product.id }}"
                                                                id="material_id{{ product.id }}">
                                                            {% for material in material_list %}
                                                                <option {% if material.id == product_info.one_floor.material_type.id %}selected{% endif %}
                                                                        value="{{ material.id }}">{{ material.material_name }}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                <div class="form-group">
                                                        <label for="exampleInputInfo">开机做片时间(单位:秒)</label>
                                                        <input type="text" class="form-control" value="{% if product.one_floor.power_time %}{{ product.one_floor.power_time }}{% endif %}"
                                                               id="power_time{{ product.id }}" onblur="checkPowerTime(this.value, {{ product.id }})"
                                                               name="power_time{{ product.id }}" placeholder="开机做片时间">
                                                    </div>
                                                <div class="form-group">
                                                        <label for="exampleInputInfo">拉片长度(单位:厘米)</label>
                                                        <input type="text" class="form-control" value="{% if product.one_floor.pulling_long %}{{ product.one_floor.pulling_long }}{% endif %}"
                                                               id="pulling_long{{ product.id }}" onblur="checkPullingLong(this.value, {{ product.id }})"
                                                               name="pulling_long{{ product.id }}" placeholder="拉片长度">
                                                    </div>
                                                <div class="form-group">
                                                        <label for="exampleInputInfo">每片出货数(单位:个/套)</label><br>
                                                        <input type="text" class="form-control" style="width: 250px;display: inline" value="{% if product.one_floor.shipment_num %}{{ product.one_floor.shipment_num }}{% endif %}"
                                                               id="shipment_num{{ product.id }}" onchange="calculate_nums({{ product.id }})"
                                                               name="shipment_num{{ product.id }}" placeholder="每片出货数">
                                                        <select id="slice_company{{ product.id }}" name="slice_company{{ product.id }}" style="width: 250px;display: inline" class="form-control">
                                                            <option {% if product.one_floor.slice_company == 1 %}selected{% endif %} value="1">个</option>
                                                            <option {% if product.one_floor.slice_company == 2 %}selected{% endif %} value="2">套</option>
                                                        </select>
                                                    </div>
                                                 <div class="form-group">
                                                        <label for="exampleInputInfo">每吨出货片数(单位:片)</label>
                                                        <input type="text" class="form-control" value="{% if product.one_floor.ton_num %}{{ product.one_floor.ton_num }}{% endif %}"
                                                               id="ton_num{{ product.id }}" readonly
                                                               name="ton_num{{ product.id }}" placeholder="每吨出货片数">
                                                    </div>
                                                 <div class="form-group">
                                                        <label for="exampleInputInfo">每吨成品数(单位:{% if product.one_floor.slice_company == 1 %}个{% elif product.one_floor.slice_company == 2 %}套{% endif %})</label>
                                                       <input type="text" class="form-control" id="ton_nums{{ product.id }}" disabled value="{% if product.one_floor.ton_nums %}{{ product.one_floor.ton_nums }}{% endif %}" name="ton_nums" autocomplete="off" class="layui-input">
                                                    </div>
                                                   <div class="form-group">
                                                        <label for="exampleInputInfo">每吨拉片时长(单位:小时)</label>
                                                        <input type="text" class="form-control" value="{% if product.one_floor.ton_slice_time %}{{ product.one_floor.ton_slice_time }}{% endif %}"
                                                               id="ton_slice_time{{ product.id }}" readonly
                                                               name="ton_slice_time{{ product.id }}" placeholder="每吨拉片时长">
                                                    </div>
                                                    <p class="help-block" id="ts{{ product.id }}"></p>
                                                    <button type="submit" onclick="edit_member({{ product.id }})"
                                                            class="btn btn-success">编辑
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                            </tbody>
                        </table>
                    </section>
                </div>
            </div>
            <!-- page end-->
        </section>
    </section>
    <!--main content end-->
</section>
<div id="outerdiv"
     style="position:fixed;top:0;left:0;background:rgba(0,0,0,0.7);z-index:2;width:100%;height:100%;display:none;">
    <div id="innerdiv" style="position:absolute;">
        <img id="bigimg" style="border:5px solid #fff;" src=""/>
    </div>
</div>
<script type="text/javascript" src="/static/assets/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
<script type="text/javascript" src="/static/assets/bootstrap-daterangepicker/date.js"></script>
<script type="text/javascript" src="/static/assets/bootstrap-daterangepicker/daterangepicker.js"></script>
<script type="text/javascript" src="/static/assets/bootstrap-colorpicker/js/bootstrap-colorpicker.js"></script>
<script type="text/javascript" src="/static/assets/ckeditor/ckeditor.js"></script>
<script>
    function checkMaterialHeight(MaterialHeight, id) {
        if (!MaterialHeight) {
            $('#ts' + id).text("材料-宽 不可为空");
        }else {
            $('#ts' + id).text("");
        }
    }
    function checkMaterialThickness(MaterialThickness, id) {
        if (!MaterialThickness) {
            $('#ts' + id).text("材料-厚度 不可为空");
        }else {
            $('#ts' + id).text("");
        }
    }
    function checkPowerTime(PowerTime, id) {
        if (!PowerTime) {
            $('#ts' + id).text("开机做片时间 不可为空");
        }else {
            $('#ts' + id).text("");
        }
    }
    function checkPullingLong(PullingLong, id) {
        if (!PullingLong) {
            $('#ts' + id).text("拉片长度 不可为空");
        }else {
            $('#ts' + id).text("");
        }
    }
    function checkShipmentNum(ShipmentNum, id) {
        if (!ShipmentNum) {
            $('#ts' + id).text("每片出货数 不可为空");
        }else {
            $('#ts' + id).text("");
        }
    }
    function calculate_nums(id){
        var material_height = $("#material_height" + id).val();
        var material_thickness = $("#material_thickness" + id).val();
        var power_time = $("#power_time" + id).val();
        var pulling_long = $("#pulling_long" + id).val();
        var shipment_num = $("#shipment_num" + id).val();
        if (material_height && material_thickness  && power_time && pulling_long && shipment_num){
             $('#ts' + id).text("");
            var ton_num = (1000000 / (material_height / 10 * pulling_long * 1.4 * material_thickness / 1000)).toFixed(0);
            var ton_nums = (ton_num * shipment_num).toFixed(0);
            var ton_slice_time = (ton_num * power_time / 3600).toFixed(2);
            $('#ton_num'+id).val(ton_num);
            $('#ton_nums'+id).val(ton_nums);
            $('#ton_slice_time'+id).val(ton_slice_time);

        }else {
           $('#ts' + id).text("必填数据 不可为空");
        }
    }
    function edit_member(id) {
        var formData = new FormData();
        {#var customer_name = $("#customer_name_id" + id).val();#}
        var product_name = $("#product_name" + id).val();
        {#var one_floor = $("#one_floor" + id).val();#}
        var material_height = $("#material_height" + id).val();
        var material_thickness = $("#material_thickness" + id).val();
        var material_id = $("#material_id" + id).val();
        var power_time = $("#power_time" + id).val();
        var pulling_long = $("#pulling_long" + id).val();
        var slice_company = $("#slice_company" + id).val();
        var shipment_num = $("#shipment_num" + id).val();
        {#var ton_num = $("#ton_num" + id).val();#}
        {#var ton_slice_time = $("#ton_slice_time" + id).val();#}
        {#formData.append("customer_name", customer_name);#}
        formData.append("product_name", product_name);
        {#formData.append("one_floor", one_floor);#}
        formData.append("material_height", material_height);
        formData.append("material_thickness", material_thickness);
        formData.append("material_id", material_id);
        formData.append("power_time", power_time);
        formData.append("pulling_long", pulling_long);
        formData.append("slice_company", slice_company);
        formData.append("shipment_num", shipment_num);
        {#formData.append("ton_num", ton_num);#}
        {#formData.append("ton_slice_time", ton_slice_time);#}
        $.ajax({
            type: "POST",
            url: '/home/edit_one_floor_info/' + id + '/',
            data: formData,
            contentType: false,
            processData: false,
            success: function (data) {
                if (data.code === 1000) {
                    $('#ts' + id).text(data.msg);
                    location.reload()
                } else {
                    $('#ts' + id).text(data.msg);
                    location.reload()
                }
            }
        })
        return false;
    }

    function delete_member(id) {
        Showbo.Msg.confirm('您确定删除这条记录吗？', function (x) {
            if (x === 'yes') {
                $.post("/home/del_product/" + id + '/', function (data) {
                        if (data.code === 1000) {
                            Showbo.Msg.alert(data.msg);
                            location.reload()
                        } else {
                            Showbo.Msg.alert(data.msg);
                            location.reload()
                        }
                    }
                )
            }
        });
    }
</script>

<script type="text/javascript">

    $(function () {
        $(".pic").click(function () {
            var _this = $(this);//将当前的pimg元素作为_this传入函数
            imgShow("#outerdiv", "#innerdiv", "#bigimg", _this);
        });
    });

    function imgShow(outerdiv, innerdiv, bigimg, _this) {
        var src = _this.attr("src");//获取当前点击的pimg元素中的src属性
        $(bigimg).attr("src", src);//设置#bigimg元素的src属性
        /*获取当前点击图片的真实大小，并显示弹出层及大图*/
        $("<img/>").attr("src", src).load(function () {
            var windowW = $(window).width();//获取当前窗口宽度
            var windowH = $(window).height();//获取当前窗口高度
            var realWidth = this.width;//获取图片真实宽度
            var realHeight = this.height;//获取图片真实高度
            var imgWidth, imgHeight;
            var scale = 0.8;//缩放尺寸，当图片真实宽度和高度大于窗口宽度和高度时进行缩放
            if (realHeight > windowH * scale) {//判断图片高度
                imgHeight = windowH * scale;//如大于窗口高度，图片高度进行缩放
                imgWidth = imgHeight / realHeight * realWidth;//等比例缩放宽度
                if (imgWidth > windowW * scale) {//如宽度扔大于窗口宽度
                    imgWidth = windowW * scale;//再对宽度进行缩放
                }
            } else if (realWidth > windowW * scale) {//如图片高度合适，判断图片宽度
                imgWidth = windowW * scale;//如大于窗口宽度，图片宽度进行缩放
                imgHeight = imgWidth / realWidth * realHeight;//等比例缩放高度
            } else {//如果图片真实高度和宽度都符合要求，高宽不变
                imgWidth = realWidth;
                imgHeight = realHeight;
            }
            $(bigimg).css("width", imgWidth);//以最终的宽度对图片缩放
            var w = (windowW - imgWidth) / 2;//计算图片与窗口左边距
            var h = (windowH - imgHeight) / 2;//计算图片与窗口上边距
            $(innerdiv).css({"top": h, "left": w});//设置#innerdiv的top和left属性
            $(outerdiv).fadeIn("fast");//淡入显示#outerdiv及.pimg
        });
        $(outerdiv).click(function () {//再次点击淡出消失弹出层
            $(this).fadeOut("fast");
        });
    }

</script>
<!-- js placed at the end of the document so the pages load faster -->

<script src="/static/js/bootstrap.min.js"></script>
<script src="/static/js/jquery.scrollTo.min.js"></script>
<script src="/static/js/jquery.nicescroll.js" type="text/javascript"></script>


<!--common script for all pages-->
<script src="/static/js/common-scripts.js"></script>
<script type="text/javascript" src="/static/js/showBo.js"></script>


</body>
</html>
